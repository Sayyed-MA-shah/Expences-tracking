{% extends 'base.html' %}
{% block title %}Payments - WINSIDE{% endblock %}
{% block content %}

<div class="flex items-center justify-between">
  <h1 class="text-xl font-semibold">Payment Detail</h1>
  <a href="{% url 'payments:create' %}" class="px-3 py-2 rounded bg-blue-600 text-white">Add</a>
</div>

<!-- Tabs -->


<!-- (Optional) visible subtotal for the current tab -->
<!-- <p class="mt-3 text-sm text-gray-600">
  Showing <strong>
    {% if active_tab == 'in' %}Pay-in{% elif active_tab == 'out' %}Pay-out{% else %}All{% endif %}
  </strong>: ¬£{{ visible_total|default:0 }}
</p> -->

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-4">
  <div class="bg-white p-4 rounded-xl shadow">Total Pay-in: <strong>PKR {{ total_payin|default:0 }}</strong></div>
  <div class="bg-white p-4 rounded-xl shadow">Total Expenses (Pay-out): <strong>PKR {{ total_payout|default:0 }}</strong></div>
  <div class="bg-white p-4 rounded-xl shadow">Balance: <strong>PKR {{ balance|default:0 }}</strong></div>
</div>
<div class="mt-4">
      {# Date Filter #}
<form method="get" class="mt-4 bg-white p-3 rounded-xl shadow flex flex-col md:flex-row md:items-end gap-3">
  <div>
    <label class="block text-sm text-gray-600 mb-1">From</label>
    <input type="date" name="start" value="{{ start_date }}" class="px-3 py-2 rounded border w-full">
  </div>
  <div>
    <label class="block text-sm text-gray-600 mb-1">To</label>
    <input type="date" name="end" value="{{ end_date }}" class="px-3 py-2 rounded border w-full">
  </div>

  {# Keep current tab when filtering #}
  <input type="hidden" name="tab" value="{{ active_tab|default:'all' }}">

  <div class="flex gap-2">
    <button class="px-4 py-2 rounded bg-blue-600 text-white font-medium">Filter</button>
    <a href="{% url 'payments:list' %}?tab={{ active_tab|default:'all' }}"
       class="px-4 py-2 rounded border font-medium">Clear</a>
  </div>
</form><br>
  <nav class="flex gap-2" role="tablist">


    <!-- All -->
    <a href="{% url 'payments:list' %}?tab=all"
       aria-current="{% if active_tab == 'all' %}page{% else %}false{% endif %}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition
              {% if active_tab == 'all' %}
                bg-blue-600 text-white shadow
              {% else %}
                text-gray-700 hover:bg-gray-50 hover:text-gray-900
              {% endif %}">
      üóÇÔ∏è <span>All</span>
      <span class="ml-1 text-[11px] rounded-full px-2 py-0.5
                   {% if active_tab == 'all' %}bg-white/20 text-white{% else %}bg-gray-100 text-gray-700{% endif %}">
        {{ count_all }}
      </span>
    </a>

    <!-- Pay-in -->
    <a href="{% url 'payments:list' %}?tab=in"
       aria-current="{% if active_tab == 'in' %}page{% else %}false{% endif %}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition
              {% if active_tab == 'in' %}
                bg-blue-600 text-white shadow
              {% else %}
                text-gray-700 hover:bg-gray-50 hover:text-gray-900
              {% endif %}">
       <span>Pay-in</span>
      <span class="ml-1 text-[11px] rounded-full px-2 py-0.5
                   {% if active_tab == 'in' %}bg-white/20 text-white{% else %}bg-gray-100 text-gray-700{% endif %}">
        {{ count_in }}
      </span>
    </a>

    <!-- Pay-out -->
    <a href="{% url 'payments:list' %}?tab=out"
       aria-current="{% if active_tab == 'out' %}page{% else %}false{% endif %}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold transition
              {% if active_tab == 'out' %}
                bg-blue-600 text-white shadow
              {% else %}
                text-gray-700 hover:bg-gray-50 hover:text-gray-900
              {% endif %}">
       <span>Pay-out</span>
      <span class="ml-1 text-[11px] rounded-full px-2 py-0.5
                   {% if active_tab == 'out' %}bg-white/20 text-white{% else %}bg-gray-100 text-gray-700{% endif %}">
        {{ count_out }}
      </span>
    </a>
  </nav>
</div>

<div class="bg-white rounded-xl shadow overflow-hidden">
  <table class="min-w-full divide-y">
    <thead class="bg-gray-100"><tr>
      <th class="px-4 py-2 text-left">Date</th>
      <th class="px-4 py-2 text-left">Description</th>
      <th class="px-4 py-2 text-left">Type</th>
      <th class="px-4 py-2 text-right">Amount</th>
      <th class="px-4 py-2 text-right">Action</th>
    </tr></thead>
    <tbody class="divide-y">
    {% for i in items %}
      <tr class="bg-white">
        <td class="px-4 py-2">{{ i.date }}</td>
        <td class="px-4 py-2">{{ i.description }}</td>
        <td class="px-4 py-2">{{ i.get_type_display }}</td>
        <td class="px-4 py-2 text-right">PKR {{ i.amount }}</td>
        <td class="px-4 py-2 text-right">
          <a
            href="{% url 'payments:delete' i.id %}?return={{ request.get_full_path|urlencode }}"
            class="inline-block px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700"
          >Delete</a>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">No records yet.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
