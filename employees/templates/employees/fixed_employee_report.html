{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto bg-white p-6 rounded-xl shadow space-y-6">

  <!-- Header -->
  <div class="flex justify-between items-center border-b pb-3 no-print">
    <h2 class="text-2xl font-bold text-gray-800">
      {{ employee.name }} â€“ <span class="text-gray-600">Fixed Salary Report</span>
    </h2>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h4 class="text-gray-500 text-sm">Total Salary (Monthly + OT)</h4>
      <p class="text-2xl font-bold text-green-600 mt-2">PKR {{ total_salary }}</p>
    </div>
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h4 class="text-gray-500 text-sm">Overtime Total</h4>
      <p class="text-2xl font-bold text-purple-600 mt-2">PKR {{ overtime_total }}</p>
    </div>
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h4 class="text-gray-500 text-sm">Salary Paid</h4>
      <p class="text-2xl font-bold text-blue-600 mt-2">PKR {{ total_paid }}</p>
    </div>
    <div class="bg-white shadow rounded-xl p-6 text-center">
      <h4 class="text-gray-500 text-sm">Balance</h4>
      <p class="text-2xl font-bold {% if balance < 0 %}text-red-600{% else %}text-green-600{% endif %} mt-2">
        PKR {{ balance }}
      </p>
    </div>
  </div>

  <!-- Date Filter + Actions -->
  <form method="get" class="flex flex-wrap gap-3 items-center bg-gray-100 p-3 rounded-lg no-print">
    <label class="flex items-center space-x-1">
      <input type="date" name="start_date" value="{{ start_date }}" class="border rounded p-1">
    </label>
    <label class="flex items-center space-x-1">
      <input type="date" name="end_date" value="{{ end_date }}" class="border rounded p-1">
    </label>
    <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded shadow hover:bg-blue-700">Filter</button>
    {% if start_date or end_date %}
      <a href="{% url 'employees:fixed_employee_report' employee.id %}"
         class="px-3 py-1 bg-gray-300 text-black rounded hover:bg-gray-400">Clear</a>
    {% endif %}

    <div class="ml-auto flex gap-2">
      <a href="{% url 'employees:fixed_employee_add_salary' employee.id %}"
         class="px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700">+ Add Salary</a>
      <a href="{% url 'employees:fixed_employee_add_work' employee.id %}"
         class="px-4 py-2 bg-purple-600 text-white rounded-lg shadow hover:bg-purple-700">+ Add Work</a>
      <button type="button" onclick="window.print()" class="px-4 py-2 bg-green-600 text-white rounded">ðŸ–¨ Print</button>
      <a href="{% url 'employees:fixed_employee_payslip' employee.id %}?start_date={{ start_date }}&end_date={{ end_date }}"
         class="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700">ðŸ§¾ Payslip</a>
    </div>
  </form>

  <!-- Payments Table -->
  <div class="overflow-x-auto">
    <h3 class="text-lg font-semibold mb-2">Salary Payments</h3>
    <table class="w-full border-collapse rounded-lg shadow">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="p-2 text-left">Date</th>
          <th class="p-2 text-left">Description</th>
          <th class="p-2 text-left">Amount Paid</th>
          <th class="p-2 text-left">Action</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y">
        {% for payment in payments %}
          <tr class="hover:bg-gray-50">
            <td class="p-2">{{ payment.date }}</td>
            <td class="p-2">{{ payment.description }}</td>
            <td class="p-2 font-semibold text-green-700">PKR {{ payment.amount }}</td>
            <td class="p-2">
              <form method="post" action="{% url 'employees:fixed_delete_salary_payment' employee.id payment.id %}">
                {% csrf_token %}
                <button class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"
                        onclick="return confirm('Delete this salary payment?');">Delete</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="4" class="p-2 text-center text-gray-500">No payments found.</td></tr>
        {% endfor %}
      </tbody>
      <tfoot class="bg-gray-100 font-bold">
        <tr>
          <td class="p-2 text-right" colspan="2">Total Paid:</td>
          <td class="p-2">PKR {{ total_paid }}</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Overtime Work Table -->
  <div class="overflow-x-auto">
    <h3 class="text-lg font-semibold mt-8 mb-2">Overtime / Extra Work</h3>
    <table class="w-full border-collapse rounded-lg shadow">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="p-2 text-left">Date</th>
          <th class="p-2 text-left">Description</th>
          <th class="p-2 text-left">Hours</th>
          <th class="p-2 text-left">Rate</th>
          <th class="p-2 text-left">Amount</th>
          <th class="p-2 text-left">Action</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y">
        {% for w in work_records %}
          <tr class="hover:bg-gray-50">
            <td class="p-2">{{ w.date }}</td>
            <td class="p-2">{{ w.description }}</td>
            <td class="p-2">{{ w.hours }}</td>
            <td class="p-2">PKR {{ w.rate }}</td>
            <td class="p-2 font-semibold text-purple-700">PKR {{ w.amount }}</td>
            <td class="p-2">
              <form method="post" action="{% url 'employees:fixed_delete_work_record' employee.id w.id %}">
                {% csrf_token %}
                <button class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700"
                        onclick="return confirm('Delete this work entry?');">Delete</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="p-2 text-center text-gray-500">No overtime work found.</td></tr>
        {% endfor %}
      </tbody>
      <tfoot class="bg-gray-100 font-bold">
        <tr>
          <td class="p-2 text-right" colspan="4">Overtime Total:</td>
          <td class="p-2">PKR {{ overtime_total }}</td>
          <td></td>
        </tr>
        <tr>
          <td class="p-2 text-right" colspan="4">Balance (Salary + OT âˆ’ Paid):</td>
          <td class="p-2 {% if balance < 0 %}text-red-600{% else %}text-green-600{% endif %}">PKR {{ balance }}</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

</div>

<style>
  @media print { .no-print { display: none !important; } nav, footer { display: none !important; } body { background: white !important; } }
</style>
{% endblock %}
