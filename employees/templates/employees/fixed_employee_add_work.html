{% extends "base.html" %}
{% block content %}
<div class="max-w-lg mx-auto bg-white rounded-2xl shadow p-6 space-y-6">

  <div class="flex items-center justify-between">
    <h2 class="text-2xl font-bold">🛠 Log Work / Overtime</h2>
    <a href="{% url 'employees:fixed_employee_report' employee.id %}"
       class="text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700">
      ← Back to Report
    </a>
  </div>

  <div class="bg-indigo-50 border border-indigo-200 text-indigo-700 px-4 py-3 rounded-lg">
    Employee: <strong>{{ employee.name }}</strong>
  </div>

  <form method="post" class="space-y-5">
    {% csrf_token %}

    <div>
      <label for="{{ form.date.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-1">Work Date</label>
      {{ form.date }}
      {% if form.date.errors %}<p class="text-red-600 text-sm mt-1">{{ form.date.errors.0 }}</p>{% endif %}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label for="{{ form.hours.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-1">Hours</label>
        {{ form.hours }}
      </div>
      <div>
        <label for="{{ form.rate.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-1">Rate (£/hr)</label>
        {{ form.rate }}
      </div>
      <div>
        <label for="{{ form.amount.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-1">Amount (£)</label>
        {{ form.amount }}
        <p class="text-xs text-gray-500 mt-1">Auto-calculates if Hours & Rate are filled (you can override).</p>
      </div>
    </div>

    <div>
      <label for="{{ form.description.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-1">
        Description (optional)
      </label>
      {{ form.description }}
    </div>

    <div class="pt-2 flex items-center justify-between">
      <button type="button"
              onclick="if (document.referrer) { location=document.referrer; } else { history.back(); }"
              class="px-4 py-2 rounded-lg border text-gray-700 hover:bg-gray-50">
        ← Back
      </button>
      <button type="submit"
              class="px-5 py-2.5 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-semibold shadow-sm transition">
        💾 Save Work
      </button>
    </div>
  </form>
</div>

<script>
  // Auto-calc amount = hours * rate (2dp)
  function recalc() {
    const h = parseFloat(document.getElementById("id_hours")?.value || 0);
    const r = parseFloat(document.getElementById("id_rate")?.value || 0);
    if (!isNaN(h) && !isNaN(r)) {
      document.getElementById("id_amount").value = (h * r).toFixed(2);
    }
  }
  ["id_hours", "id_rate"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener("input", recalc);
  });
</script>
{% endblock %}
