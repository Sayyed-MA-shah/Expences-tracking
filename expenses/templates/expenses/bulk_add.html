{% extends "base.html" %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow">
  <form method="post" class="space-y-4">
    {% csrf_token %}
    <h2 class="text-xl font-semibold mb-4">ðŸ’¸ Add Expenses</h2>

    <table class="w-full border rounded-lg" id="expenseTable">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2">Date</th>
          <th class="p-2">Category</th>
          <th class="p-2">Amount (Â£)</th>
          <th class="p-2">Description</th>
          <th class="p-2">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="p-2">
            <input type="date" name="date[]" value="{{ today }}" class="border p-2 rounded w-full">
          </td>
          <td class="p-2">
            <select name="category[]" class="border p-2 rounded w-full">
              <option value="">-- Select --</option>
              <option value="MATERIAL">Material Expense</option>
              <option value="RBG">Rent / Bill / Guest</option>
              <option value="SETUP">Setup Purchase</option>
              <option value="OUTSOURCE">Outsource</option>
              <option value="LOGISTICS">Logistics</option>
            </select>
          </td>
          <td class="p-2">
            <input type="number" step="0.01" name="amount[]" class="border p-2 rounded w-full" required>
          </td>
          <td class="p-2">
            <input type="text" name="description[]" placeholder="Optional details" class="border p-2 rounded w-full">
          </td>
          <td class="p-2 text-center">
            <button type="button" onclick="removeRow(this)" class="px-3 py-1 bg-red-500 text-white rounded">âœ–</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="flex justify-between mt-4">
      <button type="button" onclick="addRow()" class="px-4 py-2 bg-blue-600 text-white rounded">âž• Add Row</button>
      <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded">âœ… Save Records</button>
    </div>
  </form>
</div>

<script>
function addRow() {
  const tbody = document.getElementById("expenseTable").getElementsByTagName("tbody")[0];
  const newRow = tbody.rows[0].cloneNode(true);

  // clear inputs/selects in the cloned row
  newRow.querySelectorAll("input, select").forEach(el => {
    if (el.tagName === "SELECT") {
      el.selectedIndex = 0;
    } else {
      el.value = "";
    }
  });

  tbody.appendChild(newRow);
}

function removeRow(btn) {
  const row = btn.closest("tr");
  const tbody = document.getElementById("expenseTable").getElementsByTagName("tbody")[0];
  if (tbody.rows.length > 1) {
    row.remove();
  } else {
    alert("At least one row is required.");
  }
}
</script>
{% endblock %}
