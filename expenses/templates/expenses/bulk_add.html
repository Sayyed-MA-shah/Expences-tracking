{% extends "base.html" %}
{% block title %}Add Multiple Expenses{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6">Add Multiple Expenses</h1>

<form method="post">
  {% csrf_token %}

  <table class="w-full border-collapse">
    <thead>
      <tr class="bg-gray-100">
        <th class="p-2">Date</th>
        <th class="p-2">Category</th>
        <th class="p-2">Amount</th>
        <th class="p-2">Description</th>
      </tr>
    </thead>
    <tbody id="expense-rows">
  <tr>
    <td><input type="date" name="date[]" value="{{ today }}" class="border rounded p-1 w-full"></td>
    <td>
      <select name="category[]" class="border rounded p-1 w-full">
        <option value="MATERIAL">Material Expense</option>
        <option value="RBG">Rent / Bill / Guest</option>
        <option value="SETUP">Setup Purchase</option>
      </select>
    </td>
    <td><input type="number" step="0.01" name="amount[]" class="border rounded p-1 w-full"></td>
    <td><input type="text" name="description[]" class="border rounded p-1 w-full"></td>
    <td><button type="button" onclick="deleteRow(this)" class="text-red-600 font-bold">‚ùå</button></td>
  </tr>
</tbody>

  </table>

  <div class="flex gap-4 mt-4">
    <button type="button" onclick="addRow()" class="px-4 py-2 bg-gray-600 text-white rounded">+ Add Row</button>
    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded">üíæ Save All</button>
  </div>
</form>
<script>
    
function addRow() {
  const tbody = document.getElementById("expense-rows");
  const newRow = document.createElement("tr");

  newRow.innerHTML = `
    <td><input type="date" name="date[]" value="{{ today }}" class="border rounded p-1 w-full"></td>
    <td>
      <select name="category[]" class="border rounded p-1 w-full">
        <option value="MATERIAL">Material Expense</option>
        <option value="RBG">Rent / Bill / Guest</option>
        <option value="SETUP">Setup Purchase</option>
      </select>
    </td>
    <td><input type="number" step="0.01" name="amount[]" class="border rounded p-1 w-full"></td>
    <td><input type="text" name="description[]" class="border rounded p-1 w-full"></td>
    <td><button type="button" onclick="deleteRow(this)" class="text-red-600 font-bold">‚ùå</button></td>
  `;
  tbody.appendChild(newRow);
}
function deleteRow(button) {
  button.closest("tr").remove();
}
</script>


<script>
  document.getElementById("add-more").addEventListener("click", function() {
    let totalForms = document.getElementById("id_form-TOTAL_FORMS");
    let currentForms = parseInt(totalForms.value);
    let newForm = document.querySelector("tbody tr").cloneNode(true);

    // Clear inputs
    newForm.querySelectorAll("input, select").forEach(input => {
      input.name = input.name.replace(`-${currentForms-1}-`, `-${currentForms}-`);
      input.id = input.id.replace(`-${currentForms-1}-`, `-${currentForms}-`);
      if (input.type !== "hidden") input.value = "";
    });

    document.querySelector("tbody").appendChild(newForm);
    totalForms.value = currentForms + 1;
  });
</script>
{% endblock %}
